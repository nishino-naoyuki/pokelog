# PTCGLログリプレイアプリ UI設計書

## 1. 概要

このドキュメントは、PTCGLのログファイルから対戦をリプレイ表示するアプリケーションのUI設計をまとめたものです。

## 2. 画面レイアウト

### 2.1 全体構成

```
┌─────────────────────────────────────────────────────────────┐
│  [ターン表示]  Turn # 3 - Player1's Turn        [コントロール] │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  [相手サイド]      [相手トラッシュ] [相手山札]                │
│     (6)                                                       │
│                                                               │
│          [相手ベンチ] (最大5匹、横並び)                       │
│          ┌──┐ ┌──┐ ┌──┐ ┌──┐ ┌──┐              │
│          │  │ │  │ │  │ │  │ │  │              │
│          └──┘ └──┘ └──┘ └──┘ └──┘              │
│                                                               │
│  [スタジアム]    [相手バトル場]                               │
│   ┌────┐         ┌─────┐                         │
│   │    │         │     │                         │
│   └────┘         └─────┘                         │
│                                                               │
│                  [自分バトル場]                               │
│                     ┌─────┐                         │
│                     │     │                         │
│                     └─────┘                         │
│                                                               │
│          [自分ベンチ] (最大5匹、横並び)                       │
│          ┌──┐ ┌──┐ ┌──┐ ┌──┐ ┌──┐              │
│          │  │ │  │ │  │ │  │ │  │              │
│          └──┘ └──┘ └──┘ └──┘ └──┘              │
│                                                               │
│  [自分サイド]      [自分トラッシュ] [自分山札]                │
│     (6)                                                       │
│                                                               │
│                    [手札エリア]                               │
│     ┌──┐ ┌──┐ ┌──┐ ┌──┐ ┌──┐ ┌──┐ ┌──┐       │
│     │  │ │  │ │  │ │  │ │  │ │  │ │  │       │
│     └──┘ └──┘ └──┘ └──┘ └──┘ └──┘ └──┘       │
├─────────────────────────────────────────────────────────────┤
│  [ログエリア]                                                 │
│  > Player1 drew Nest Ball.                                   │
│  > Player1 がネストボールを引きました。                      │
│  > Player1 played Nest Ball.                                 │
│  > Player1 がネストボールを使用しました。                    │
│  > Player1 drew Rotom V and played it to the Bench.          │
│  > Player1 がロトムVを引いてベンチに出しました。             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 各エリアの詳細位置

| エリア | 位置 | 備考 |
|--------|------|------|
| **バトル場（相手）** | 画面中央上部 | 1体のみ、大きめに表示 |
| **バトル場（自分）** | 画面中央下部 | 1体のみ、大きめに表示 |
| **ベンチ（相手）** | 画面上部 | 最大5匹、横並び |
| **ベンチ（自分）** | 画面下部 | 最大5匹、横並び |
| **手札** | 画面最下部 | 横並び表示 |
| **トラッシュ（相手）** | 右上 | クリックで内容表示 |
| **トラッシュ（自分）** | 右下 | クリックで内容表示 |
| **山札（相手）** | トラッシュの左側（右上） | 枚数表示なし |
| **山札（自分）** | トラッシュの左側（右下） | 枚数表示なし |
| **サイドカード** | 左側 | サイド残数を数値で表示 |
| **スタジアム** | 画面中央左側 | 両プレイヤー共通 |
| **ログエリア** | 画面下部 | 常時表示、スクロール可能 |

## 3. カード表示の仕様

### 3.1 カードサイズ

- **バトル場**: 大サイズ（基準サイズ）
- **ベンチ**: バトル場より小さいサイズ（約70%）
- **手札**: ベンチと同じサイズ
- **スタジアム**: 中サイズ

### 3.2 カード詳細の表示

- **クリック**: カードをクリックすると、大きくポップアップで表示
- **ホバー表示**: なし
- **カードの向き**: すべて縦向き（特殊状態でも変えない）

### 3.3 進化ポケモンの表示

- **表示形態**: 最終進化形のみ表示
- **進化元**: 下に重ねて非表示（データとしては保持）

## 4. ダメージとステータスの表示

### 4.1 ダメージカウンター

**表示方法:**
- ポケモンカードの上に、数字が書かれたアイコンを重ねて表示

**例:**
```
┌─────────┐
│ [30]    │  ← ダメカン表示（右上または中央上）
│         │
│ ポケモン │
│         │
└─────────┘
```

**参考**: `doc/image/hqdefault.jpg` の表示形式

### 4.2 特殊状態アイコン

ポケモンカードの**左上または右上**に、アイコンで表示：

| 特殊状態 | アイコン | デザイン |
|---------|---------|---------|
| **どく** | ☠️ | ドクロマーク |
| **やけど** | 🔥 | 炎アイコン |
| **ねむり** | 💤 | "Zz" の文字アイコン |
| **マヒ** | ⚡ | 雷（しびれ）のアイコン |
| **こんらん** | ❓ | "?" のアイコン |

**複数状態の場合:**
- アイコンを横に並べて表示
- 例: ☠️🔥（どく+やけど）

## 5. エネルギーと道具の表示

### 5.1 エネルギーカード

**表示位置**: カード下部

**表示方法**: 横並びで表示

**例:**
```
┌─────────┐
│         │
│ ポケモン │
│         │
├─────────┤
│🌿🌿⚡  │  ← エネルギー（草×2、雷×1）
└─────────┘
```

**複数枚の場合**: アイコンを並べて表示

### 5.2 ポケモンのどうぐ

**表示位置**: カード中央左側

**表示方法**: 小さなアイコンまたはカード画像

**例:**
```
┌─────────┐
│         │
│🔧       │  ← 道具アイコン（左中央）
│ ポケモン │
│         │
└─────────┘
```

**参考**: `doc/image/hqdefault.jpg` の表示形式

## 6. ベンチの拡張表示

### 6.1 通常時（5匹まで）

```
┌──┐ ┌──┐ ┌──┐ ┌──┐ ┌──┐
│  │ │  │ │  │ │  │ │  │
└──┘ └──┘ └──┘ └──┘ └──┘
```

横一列に並べて表示

### 6.2 拡張時（6〜8匹）

```
┌──┐ ┌──┐ ┌──┐ ┌──┐
│  │ │  │ │  │ │  │
└──┘ └──┘ └──┘ └──┘
┌──┐ ┌──┐ ┌──┐ ┌──┐
│  │ │  │ │  │ │  │
└──┘ └──┘ └──┘ └──┘
```

2列で表示

> [!NOTE]
> スタジアムやポケモンの効果で、ベンチが8匹まで並べられることがあります。

## 7. ターン表示とコントロール

### 7.1 ターン情報表示

**表示位置**: 画面上部中央

**表示内容:**
```
Turn # 3 - Player1's Turn
```

**表示形式:**
- ターン番号
- 現在のプレイヤー名

> [!IMPORTANT]
> PTCGLにはターン表示がありませんが、リプレイアプリでは必須です。

### 7.2 コントロールボタン

**表示位置**: 画面上部右側

**ボタン:**
- ⏮️ **最初へ**: ゲーム開始時に戻る
- ⏪ **前のアクション**: 1つ前のアクションに戻る
- ⏸️ **一時停止**: 自動再生を停止
- ▶️ **再生**: 自動再生開始
- ⏩ **次のアクション**: 1つ次のアクションへ
- ⏭️ **最後へ**: ゲーム終了時へ

**速度調整:**
- スライダーで再生速度を調整（0.5x 〜 3.0x）

## 8. ログエリア

### 8.1 表示位置と形式

**表示位置**: 画面下部（または右サイド）

**表示形式:**
- スクロール可能なログリスト
- 最新のアクションが下に追加される

### 8.2 ログ内容

**表示言語**: 日本語

**表示例:**
```
> Player1 がカードを1枚引きました。
> Player1 がネストボールを使用しました。
> Player1 がロトムVを山札から引いてベンチに出しました。
> Player1 が山札をシャッフルしました。
> Player1 のロトムVが「インスタントチャージ」を使いました。
> Player1 がカードを3枚引きました。
> Player1 のターンが終了しました。
```

**ハイライト:**
- 重要なアクション（ワザ使用、きぜつ、サイド取得）は色分け表示
- 例: きぜつ → 赤、サイド取得 → 金色

## 9. サイドカード表示

### 9.1 表示位置

**位置**: 画面左側

**配置:**
```
[相手サイド]
   (6)
   [■]
   [■]
   [■]
   [■]
   [■]
   [■]




[自分サイド]
   (6)
   [■]
   [■]
   [■]
   [■]
   [■]
   [■]
```

### 9.2 残数表示

**表示方法**: サイドカード画像の上に数値を表示

**例:**
- `(6)` → サイド6枚残り
- `(3)` → サイド3枚残り
- `(0)` → サイドなし（勝利）

### 9.3 サイド減少のアニメーション

- サイドを取ったときは、カードが手札に移動するアニメーション
- 残数の数値も更新

## 10. 勝敗決定時の表示

### 10.1 勝利画面

**表示内容:**
```
┌───────────────────────┐
│                       │
│   Player1 Win!        │
│                       │
│   All Prize cards     │
│   taken.              │
│                       │
└───────────────────────┘
```

**表示位置**: 画面中央にオーバーレイ表示

**勝利条件の表示:**
- `All Prize cards taken.` → サイド全取得
- `Opponent conceded.` → 相手が降参
- `Opponent could not draw a card.` → 相手の山札切れ

## 11. Setup画面（オプション）

> [!NOTE]
> PTCGLでは専用のSetup画面はありませんが、リプレイアプリでは以下のように表示できます。

### 11.1 初期手札表示

**表示内容:**
- 両プレイヤーの初期手札（自分のみカード名表示）
- マリガンの有無
- コイントスの結果

### 11.2 初期配置

- バトル場とベンチへの初期配置を表示
- サイドカードのセット

## 12. アニメーションと動画

### 12.1 動画での表現

以下の要素は、静止画ではなく**動画**で表現することを推奨：

- **ターン中の画面**: カードを引く、プレイする動作
- **ワザ使用時**: エフェクトやダメージ表示
- **ポケモンのきぜつ**: カードがトラッシュに移動するアニメーション

### 12.2 簡易アニメーション

実装が簡単なアニメーション：

- **カード移動**: スライド移動（手札→場、場→トラッシュ）
- **ダメカン追加**: 数値のカウントアップ
- **カード描画**: フェードイン効果

## 13. 実装の優先順位

### Phase 1: 基本表示
- [ ] 場の状態を静止画で表示
- [ ] カード画像の配置（バトル場、ベンチ、手札）
- [ ] ダメカン表示

### Phase 2: 基本機能
- [ ] アクション進行（次へ/前へボタン）
- [ ] ログエリア表示
- [ ] ターン表示

### Phase 3: 詳細表示
- [ ] 特殊状態アイコン
- [ ] エネルギー・道具の表示
- [ ] サイドカード残数

### Phase 4: アニメーション
- [ ] カード移動アニメーション
- [ ] ダメージエフェクト
- [ ] 自動再生機能

### Phase 5: 拡張機能
- [ ] Setup画面
- [ ] 勝敗画面
- [ ] カード詳細ポップアップ

## 14. 技術的な注意点

### 14.1 カード画像の取得

**参照**: [`カード画像URL取得ガイド.md`](file:///c:/repo/pokelog/doc/カード画像URL取得ガイド.md)

- Pokemon TCG APIを使用してカード画像を取得
- ログに出てくるカード名（英語）から画像URLをマッピング

### 14.2 状態管理

**参照**: [`PTCGLログ解析.md`](file:///c:/repo/pokelog/doc/PTCGLログ解析.md) のセクション10.4

- ゲーム状態を常に追跡
- 各アクションで状態を更新
- 前後のアクションに戻れるよう履歴を保持

### 14.3 山札の枚数

> [!IMPORTANT]
> ログからは山札の正確な枚数が分からないため、表示は不要です。シャッフルやドローの記録から推測は可能ですが、完全には正確ではありません。

## 15. 参考画像

既存のPTCGL画面を参考にする：

- [`hqdefault.jpg`](file:///c:/repo/pokelog/doc/image/hqdefault.jpg) - ダメカン表示、エネルギー表示、道具表示の参考
- [`hq720.jpg`](file:///c:/repo/pokelog/doc/image/hq720.jpg) - 全体レイアウトの参考
- [`ptcglbattle.jpg`](file:///c:/repo/pokelog/doc/image/ptcglbattle.jpg) - バトル画面の参考

## 16. まとめ

このUI設計書に基づいて、PTCGLログリプレイアプリを実装することで、ログファイルから対戦を視覚的に再現できます。

**重要なポイント:**
- ログエリアに日本語でアクションを表示
- ターン表示を追加（PTCGLにはないが必須）
- 特殊状態はアイコンで表現（カードの向きは変えない）
- ベンチは最大8匹まで対応（2列表示）
- 山札枚数は表示不要
- カード詳細はクリックでポップアップ

**次のステップ:**
1. ログパーサーの実装
2. ゲーム状態管理システムの実装
3. UI表示システムの実装
4. カード画像マッピングの作成
